import fs, { existsSync } from "fs";
import path from "path";

const arquivoCsv = path.join(__dirname, "../data/estoque.csv");

export interface Item {
    nome: string,
    peso: number,
    preco: number,
    quantidade: number
}

export class ModeloEstoque{
    constructor(){
        this.verificaExistenciaArquivo();
    }
    private verificaExistenciaArquivo():void{
        if(!fs.existsSync(arquivoCsv)){
            fs.writeFileSync(arquivoCsv, "nome,peso,preco,quantidade\n");
        }
    }
    
    public leituraEstoque(): Item[]{
        const dados = fs.readFileSync(arquivoCsv, "utf-8").trim();
        const linhas = dados.split("\n").slice(1);
        return linhas.map((linha)=>{
            const [nome, peso, preco,quantidade]=linha.split(",");
            return{nome, peso:parseFloat(peso),preco:parseFloat(preco),quantidade:parseInt(quantidade,10)}
        });
    }

    public addItem(item: Item): void{
        const linha=`${item.nome},${item.peso},${item.preco},${item.quantidade}\n`;
        fs.appendFileSync(arquivoCsv,linha);
    }
}
